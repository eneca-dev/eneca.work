# Сценарии тестирования страницы Бюджеты

## Общая информация

**Страница:** `/tasks` → вкладка "Бюджеты"
**Модуль:** `modules/budgets-page`
**Дата создания:** 2026-01-05
**Автор:** Claude Code (автоматизированное тестирование)

---

## Предусловия

1. Пользователь авторизован в системе
2. Существует хотя бы один проект с иерархией (объект → раздел → этап → задача)
3. Браузер: Chrome (рекомендуется для DevTools)
4. Dev сервер запущен (`npm run dev`)

---

## 1. Загрузка и отображение страницы

### TC-001: Загрузка страницы бюджетов
**Приоритет:** Critical

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть `/tasks` | Страница загружается |
| 2 | Кликнуть на вкладку "Бюджеты" | Отображается таблица иерархии |
| 3 | Проверить header | Показаны: кол-во проектов, кол-во бюджетов, План, Факт, % освоено |
| 4 | Проверить колонки | Наименование, Кат., План ч, С К ч, % род., BYN/ч, Расчётн., Распред., Выделенный |

### TC-002: Фильтрация по проекту
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Кликнуть на поле фильтра | Открывается dropdown/combobox |
| 2 | Выбрать проект | Данные фильтруются по выбранному проекту |
| 3 | Очистить фильтр | Показываются все проекты |

---

## 2. Иерархия (Expand/Collapse)

### TC-010: Развёртывание/сворачивание узлов
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти строку проекта с иконкой ">" | Проект свёрнут |
| 2 | Кликнуть на иконку ">" | Проект разворачивается, показываются объекты |
| 3 | Развернуть объект | Показываются разделы |
| 4 | Развернуть раздел | Показываются этапы |
| 5 | Развернуть этап | Показываются задачи |
| 6 | Кликнуть "Все" (expand all) | Все узлы разворачиваются |
| 7 | Кликнуть "Скрыть" (collapse all) | Все узлы сворачиваются |

### TC-011: Визуальная иерархия
**Приоритет:** Medium

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Развернуть полную иерархию | Каждый уровень имеет отступ (indent) |
| 2 | Проверить badges | Проект/Объект/Раздел/Этап - разные цвета/стили |
| 3 | Проверить стадию проекта | Показывается badge "ст. Э" (эскизный) или другая стадия |

---

## 3. Inline редактирование бюджета

### TC-020: Редактирование бюджета раздела (сумма)
**Приоритет:** Critical
**Статус:** ✅ Работает

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти раздел с бюджетом (например 1,800 BYN) | Отображается текущее значение |
| 2 | Кликнуть на textbox суммы | Поле становится редактируемым |
| 3 | Ввести новое значение (2,500) | Значение отображается в поле |
| 4 | Нажать Tab или кликнуть вне поля | Значение сохраняется |
| 5 | Обновить страницу | Значение сохранено в БД |

### TC-021: Редактирование бюджета раздела (процент)
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти раздел с бюджетом и процентом | Отображается текущий % |
| 2 | Изменить сумму бюджета | Процент автоматически пересчитывается |
| 3 | Изменить процент напрямую | Сумма автоматически пересчитывается |

### TC-022: Редактирование бюджета этапа
**Приоритет:** Critical

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти этап с бюджетом | Отображается текущее значение |
| 2 | Изменить сумму | Значение сохраняется |
| 3 | Проверить % от родителя | Пересчитывается корректно |

### TC-023: Редактирование бюджета задачи
**Приоритет:** Critical
**Статус:** ❌ Баг BP-020 - не сохраняется

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти задачу (например "Работа 2") | Отображается бюджет (может быть 0) |
| 2 | Кликнуть на textbox суммы | Поле редактируемое |
| 3 | Ввести 500 | Значение отображается, % пересчитывается |
| 4 | Нажать Tab | **Ожидание:** сохраняется. **Факт:** откатывается к 0 |

---

## 4. Модалка "Части бюджета"

### TC-030: Открытие модалки частей бюджета
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти кнопку "Части бюджета" у любого узла | Кнопка видна |
| 2 | Кликнуть на кнопку | Открывается модалка |
| 3 | Проверить содержимое | Показано: Total BYN, Распределено %, части (Основной, Премиальный) |

### TC-031: Отображение основной части
**Приоритет:** High
**Статус:** ❌ Баг BP-019 - показывает 0

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть "Части бюджета" для раздела с бюджетом 1,800 | Модалка открывается |
| 2 | Проверить Total | Показывает 1,800 BYN |
| 3 | Проверить "Основной" | **Ожидание:** 1,800 BYN. **Факт:** 0 BYN |

### TC-032: Добавление премиальной части
**Приоритет:** Critical
**Статус:** ❌ Баг BP-018 - сбрасывает бюджет в 0

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть "Части бюджета" для объекта с бюджетом 10,000 | Модалка открывается |
| 2 | Кликнуть "+ Добавить часть" | Появляется форма добавления |
| 3 | Выбрать "Премиальный" | Тип выбран |
| 4 | Установить 20% | Процент установлен |
| 5 | Сохранить | **Ожидание:** часть добавлена, бюджет 10,000. **Факт:** бюджет становится 0 |

### TC-033: Удаление части бюджета
**Приоритет:** Medium

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть "Части бюджета" с премиальной частью | Показана часть с кнопкой "Удалить" |
| 2 | Кликнуть "Удалить" | Часть удаляется |
| 3 | Проверить Total | Бюджет не изменился |

---

## 5. Создание/удаление сущностей

### TC-040: Создание этапа декомпозиции
**Приоритет:** Critical
**Статус:** ❌ Баг BP-017 - Failed to fetch

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Развернуть раздел | Показываются этапы (или пусто) |
| 2 | Кликнуть "Добавить этап" | Появляется inline форма |
| 3 | Ввести название "Эскизный проект" | Текст введён |
| 4 | Нажать Enter | **Ожидание:** этап создан. **Факт:** ошибка "Failed to fetch" |

### TC-041: Создание задачи декомпозиции
**Приоритет:** Critical

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Развернуть этап | Показываются задачи (или пусто) |
| 2 | Кликнуть "Добавить задачу" | Появляется inline форма |
| 3 | Ввести название | Текст введён |
| 4 | Нажать Enter | Задача создана и появилась в списке |

### TC-042: Удаление этапа
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти этап с кнопкой удаления (корзина) | Кнопка видна |
| 2 | Кликнуть на корзину | Появляется подтверждение |
| 3 | Подтвердить удаление | Этап удалён вместе со всеми задачами |

### TC-043: Удаление задачи
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти задачу с кнопкой удаления | Кнопка видна |
| 2 | Кликнуть на корзину | Появляется подтверждение |
| 3 | Подтвердить удаление | Задача удалена |

---

## 6. Редактирование атрибутов задачи

### TC-050: Изменение плановых часов
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти задачу с плановыми часами | Отображается значение в колонке "План, ч" |
| 2 | Кликнуть на значение | Поле редактируемое |
| 3 | Ввести новое значение (40) | Значение отображается |
| 4 | Нажать Tab | Значение сохраняется |
| 5 | Проверить "С К, ч" | Приведённые часы пересчитаны (часы × коэфф. сложности) |

### TC-051: Изменение сложности задачи
**Приоритет:** High
**Статус:** ❌ Баг BP-014 - не работает

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти задачу с badge сложности (К, ВС, ВВС и т.д.) | Badge отображается |
| 2 | Кликнуть на badge | **Ожидание:** открывается dropdown. **Факт:** ошибка в консоли |
| 3 | Выбрать другую сложность | Сложность изменена |
| 4 | Проверить "С К, ч" | Приведённые часы пересчитаны |

### TC-052: Изменение категории работ
**Приоритет:** High
**Статус:** ❌ Баг - не работает (аналогично сложности)

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти задачу с категорией (Проектирование и т.д.) | Категория отображается |
| 2 | Кликнуть на категорию | **Ожидание:** открывается dropdown. **Факт:** ошибка |
| 3 | Выбрать другую категорию | Категория изменена |

---

## 7. Бюджет проекта

### TC-060: Создание бюджета проекта
**Приоритет:** Critical
**Статус:** ❌ Баг BP-013 - не работает

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти проект без бюджета | Кнопка "Бюджет" видна |
| 2 | Кликнуть "Бюджет" | **Ожидание:** создаётся бюджет или открывается форма. **Факт:** ничего не происходит |

### TC-061: Редактирование проекта
**Приоритет:** High
**Статус:** ❌ Баг BP-012 - модалка не работает

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Кликнуть "Редактировать проект" | Открывается модалка |
| 2 | Изменить статус/стадию | Dropdown работает |
| 3 | Сохранить | Изменения сохранены |

---

## 8. Агрегация данных

### TC-070: Агрегация часов
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Развернуть этап с несколькими задачами | Видны задачи с часами |
| 2 | Проверить часы этапа | = сумма часов всех задач |
| 3 | Проверить часы раздела | = сумма часов всех этапов |
| 4 | Проверить часы объекта | = сумма часов всех разделов |
| 5 | Проверить часы проекта | = сумма часов всех объектов |

### TC-071: Агрегация бюджетов
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Развернуть иерархию | Видны бюджеты на всех уровнях |
| 2 | Сумма "Распред." родителя | ≥ сумма "Выделенный" детей |
| 3 | Проверить % освоено в header | = Факт / План × 100% |

### TC-072: Процент от родителя
**Приоритет:** Medium

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Посмотреть колонку "% род." для задач | Показывает % от бюджета этапа |
| 2 | Сумма % всех задач этапа | ≤ 100% (может быть меньше) |
| 3 | Проверить % для разделов | % от бюджета объекта |

---

## 9. Расчёт бюджета

### TC-080: Расчётный бюджет
**Приоритет:** High

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти раздел с часами и ставкой | Колонка "Расчётн." заполнена |
| 2 | Формула | Расчётный = Приведённые часы × Ставка (BYN/ч) |
| 3 | Изменить часы задачи | Расчётный бюджет раздела пересчитывается |

### TC-081: Коэффициент сложности
**Приоритет:** Medium

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Найти задачу с 40 план. часами | "План, ч" = 40 |
| 2 | Установить сложность "К" (минимальная) | Коэффициент = 1.2 (примерно) |
| 3 | Проверить "С К, ч" | = 40 × 1.2 = 48 |
| 4 | Изменить на "ВВС" (высокая) | Коэффициент больше |
| 5 | Проверить "С К, ч" | Значение увеличилось |

---

## 10. UI/UX

### TC-090: Отзывчивость интерфейса
**Приоритет:** Medium

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Изменить бюджет | Optimistic update - UI обновляется мгновенно |
| 2 | Развернуть узел | Анимация плавная, без лагов |
| 3 | Expand All на большой иерархии | Завершается < 1 сек |

### TC-091: Состояния загрузки
**Приоритет:** Low

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | При первой загрузке | Показывается skeleton или spinner |
| 2 | При сохранении | Кнопка/поле показывает loading state |
| 3 | При ошибке | Показывается сообщение об ошибке |

### TC-092: Валидация ввода
**Приоритет:** Medium

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Ввести отрицательное число в бюджет | Не принимается или показывает ошибку |
| 2 | Ввести текст в числовое поле | Не принимается |
| 3 | Ввести слишком большое число | Обрабатывается корректно |
| 4 | Ввести процент > 100 | Warning или ограничение |

---

## Приложение: Известные баги

| ID | Приоритет | Краткое описание | Затронутые TC |
|----|-----------|------------------|---------------|
| BP-012 | Critical | Модалка редактирования проекта не работает | TC-061 |
| BP-013 | High | Бюджет проекта не создаётся | TC-060 |
| BP-014 | High | Выбор сложности не работает | TC-051 |
| BP-017 | Critical | Создание этапа падает с Failed to fetch | TC-040 |
| BP-018 | Critical | Добавление части бюджета сбрасывает в 0 | TC-032 |
| BP-019 | High | Основной в модалке показывает 0 | TC-031 |
| BP-020 | Critical | Бюджет задачи не сохраняется | TC-023 |

---

## Чек-лист для smoke-тестирования

Быстрая проверка основного функционала (5-10 минут):

- [ ] Страница загружается без ошибок
- [ ] Фильтр по проекту работает
- [ ] Иерархия разворачивается/сворачивается
- [ ] Inline редактирование бюджета раздела сохраняется
- [ ] Создание задачи работает
- [ ] Удаление задачи работает
- [ ] Часы пересчитываются при изменении


---

## Окружение тестирования

- **URL:** `http://localhost:3000/tasks`
- **Браузер:** Chrome 120+ (с DevTools для отладки)
- **Инструмент автоматизации:** Chrome DevTools MCP
- **Тестовые данные:** Проект "Демопроект", объект "Обхект"
