# –ú–æ–¥—É–ª—å Chat

–ü—Ä–æ—Å—Ç–æ–π AI-—á–∞—Ç –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Eneca.

## –ß—Ç–æ —ç—Ç–æ?

–ó–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É ‚Äî —ç—Ç–æ AI-–ø–æ–º–æ—â–Ω–∏–∫. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ —á–∞—Ç–∞, –≥–¥–µ –º–æ–∂–Ω–æ –æ–±—â–∞—Ç—å—Å—è —Å –±–æ—Ç–æ–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- üü¢ **–ó–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞** ‚Äî –æ—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å —á–∞—Ç
- üí¨ **–û–∫–Ω–æ —á–∞—Ç–∞** ‚Äî —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–≤–∞—à–∏ —Å–ø—Ä–∞–≤–∞ –∑–µ–ª—ë–Ω—ã–µ, –±–æ—Ç–∞ —Å–ª–µ–≤–∞ —Å–µ—Ä—ã–µ)
- üìê **Resize** ‚Äî —Ç—è–Ω—É—Ç—å –∑–∞ –ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
- üñ•Ô∏è **Fullscreen** ‚Äî –∫–Ω–æ–ø–∫–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å
- üóëÔ∏è **–û—á–∏—Å—Ç–∏—Ç—å** ‚Äî –∫–Ω–æ–ø–∫–∞ —Å –∫—Ä—É–≥–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–æ–π
- ‚ú® **Sparkles** ‚Äî –±—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã (–ü–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å, –°–æ–±—Ä–∞—Ç—å –æ—Ç—á—ë—Ç)
- ‚å®Ô∏è **–í–≤–æ–¥** ‚Äî Enter –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç, Shift+Enter –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞, –º–∞–∫—Å 500 —Å–∏–º–≤–æ–ª–æ–≤

### –õ–æ–≥–∏–∫–∞
- –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ **localStorage** (–Ω–∞–≤—Å–µ–≥–¥–∞, –º–∞–∫—Å 10 —à—Ç—É–∫)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ `/api/chat/python` ‚Üí Python AI-–∞–≥–µ–Ω—Ç –Ω–∞ `https://ai-bot.eneca.work`
- JWT —Ç–æ–∫–µ–Ω –∏–∑ Supabase –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ userId

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
chat/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ChatInterface.tsx    # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–∫–Ω–æ–ø–∫–∞ + –æ–∫–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ MessageList.tsx       # –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ü–µ—á–∞—Ç–∞—é..."
‚îÇ   ‚îú‚îÄ‚îÄ MessageInput.tsx      # –ü–æ–ª–µ –≤–≤–æ–¥–∞ + Sparkles + Send
‚îÇ   ‚îî‚îÄ‚îÄ MarkdownRenderer.tsx  # –†–µ–Ω–¥–µ—Ä markdown –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ useChat.ts           # –í—Å—è –ª–æ–≥–∏–∫–∞ (state + sendMessage + cache)
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ chat.ts              # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ /api/chat/python
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ chat.ts              # ChatMessage, ChatRequest, ChatResponse
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ chatCache.ts         # localStorage (save/get/clear)
    ‚îî‚îÄ‚îÄ formatTime.ts        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç ‚Üí —Å—Ä–∞–∑—É –≤ UI
2. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ Python –∞–≥–µ–Ω—Ç —á–µ—Ä–µ–∑ `/api/chat/python`
3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ü–µ—á–∞—Ç–∞—é..."
4. –û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ UI
5. –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

**ChatMessage:**
- `id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
- `role` ‚Äî 'user' –∏–ª–∏ 'assistant'
- `content` ‚Äî —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `timestamp` ‚Äî –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏

**ChatRequest:**
- `message` ‚Äî —Ç–µ–∫—Å—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**ChatResponse:**
- `message` ‚Äî –æ—Ç–≤–µ—Ç –æ—Ç –∞–≥–µ–Ω—Ç–∞

## API endpoint

```
POST /api/chat/python
Authorization: Bearer {JWT}
Body: { message: "..." }

Response: { message: "..." }
```

–ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ `https://ai-bot.eneca.work`

## useChat —Ö—É–∫

–£–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:
- `messages` ‚Äî –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- `isLoading`, `isTyping` ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- `isOpen`, `isFullscreen` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∫–Ω–∞
- `input` ‚Äî —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ
- `chatSize` ‚Äî —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞
- `sendMessage()` ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
- `clearMessages()` ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å
- `toggleChat()`, `toggleFullscreen()` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏

## –§–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|------|-----------|-------|
| useChat.ts | –í—Å—è –ª–æ–≥–∏–∫–∞ —á–∞—Ç–∞ | 156 |
| ChatInterface.tsx | UI –æ–∫–Ω–∞ –∏ –∫–Ω–æ–ø–∫–∏ | 106 |
| MessageList.tsx | –°–ø–∏—Å–æ–∫ + –ü–µ—á–∞—Ç–∞—é | 85 |
| MessageInput.tsx | –ü–æ–ª–µ –≤–≤–æ–¥–∞ + Sparkles | 112 |
| chat.ts (api) | –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ endpoint | 27 |
| chatCache.ts | localStorage | 53 |
| chat.ts (types) | –¢–∏–ø—ã | 14 |

**–ò—Ç–æ–≥–æ:** ~550 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ù–æ—è–±—Ä—å 2024 - –ü–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
–ú–æ–¥—É–ª—å –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ç–æ–ª—å–∫–æ —Å Python AI-–∞–≥–µ–Ω—Ç–æ–º.

**–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã:**
- ‚ùå N8N –∞–≥–µ–Ω—Ç –∏ –≤—Å—è —Å–≤—è–∑–∞–Ω–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
  - `/api/chat/route.ts` (N8N gateway)
  - `/api/chat/thinking/route.ts` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î)
  - `chat-system-prompts.md` (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è N8N)
  - `app/dashboard/debug/page.tsx` (debug —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
  - N8N_THINKING_SECRET –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚ùå Supabase Realtime –ø–æ–¥–ø–∏—Å–∫–∏
- ‚ùå conversationId (—Ä–∞–±–æ—Ç–∞ —Å –ë–î —Ç–∞–±–ª–∏—Ü–∞–º–∏)
- ‚ùå agentType –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å (N8N ‚ü∑ Python)
- ‚ùå Debug –ø–∞–Ω–µ–ª—å (latency, errors, subscription status)
- ‚ùå –¢–∞–π–º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (typingTimeoutRef)
- ‚ùå kind –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (thinking, tool, observation, message)

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:**
- ‚úÖ –¢–æ–ª—å–∫–æ Python AI-–∞–≥–µ–Ω—Ç
- ‚úÖ localStorage –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ (–≤–º–µ—Å—Ç–æ –ë–î)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π request/response –ø–æ—Ç–æ–∫
- ‚úÖ –ß–∏—Å—Ç—ã–π UI –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî –Ω–µ—Ç —Å–ª–æ–∂–Ω–æ–π Realtime –ª–æ–≥–∏–∫–∏, —Ç–æ–ª—å–∫–æ HTTP –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å** ‚Äî –∫–æ–¥ –ª–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å (~550 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 1000+)
- ‚úÖ **–ë—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ** ‚Äî –º–µ–Ω—å—à–µ –∫–æ–¥–∞, –º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** ‚Äî –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞, –ø—Ä–æ—â–µ debugging
- ‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º
- ‚úÖ **Offline-first** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –≤ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
User ‚Üí ChatInterface ‚Üí useChat ‚Üí api/chat.ts ‚Üí /api/chat/python ‚Üí Python Agent
                         ‚Üì
                    localStorage (history)
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- JWT —Ç–æ–∫–µ–Ω –∏–∑ Supabase –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Rate limiting –Ω–∞ API endpoint
- –ò–∑–æ–ª—è—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ userId

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **localStorage** –∫–ª—é—á: `eneca_chat_{userId}`
- **–õ–∏–º–∏—Ç:** 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **–û—á–∏—Å—Ç–∫–∞:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- **–§–æ—Ä–º–∞—Ç:** JSON –º–∞—Å—Å–∏–≤ ChatMessage[]

### API endpoint
- **URL:** `https://ai-bot.eneca.work`
- **Timeout:** 2 –º–∏–Ω—É—Ç—ã
- **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:** `{ message: string }`
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:** `{ message: string }`

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è:
- üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (–ø–∞–º—è—Ç—å –∞–≥–µ–Ω—Ç–∞)
- üìé –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∑–∞–¥–∞—á–∞–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞
- üîç –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
