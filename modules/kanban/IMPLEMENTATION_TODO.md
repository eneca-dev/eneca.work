# Список функций модуля Канбан для перевода на реальные данные

## 1. Фильтры (KanbanBoard.tsx)

### Фильтр "Организация"
- **Текущее состояние:** Моковые данные (Все, Непроизводственные отделы, Производственные отделы, ЭНЭКА - СП Групп)
- **Что нужно:**
  - Загрузка списка организаций из БД
  - Фильтрация разделов/этапов по выбранной организации
  - Сохранение выбранного фильтра в состоянии
  - Применение фильтра при загрузке данных

### Фильтр "Проект"
- **Текущее состояние:** Моковые данные (список проектов)
- **Что нужно:**
  - Загрузка списка проектов из БД (возможно, из view_sections_with_loadings)
  - Фильтрация разделов/этапов по выбранному проекту
  - Сохранение выбранного фильтра в состоянии
  - Применение фильтра при загрузке данных

### Кнопка "Сбросить фильтры"
- **Текущее состояние:** console.log('Reset filters clicked')
- **Что нужно:**
  - Сброс всех примененных фильтров
  - Перезагрузка данных без фильтров

### Кнопка "Обновить"
- **Текущее состояние:** Вызывает loadBoard() с моковыми данными
- **Что нужно:**
  - Перезагрузка данных с сервера с учетом текущих фильтров

### Кнопка "Свернуть всё / Развернуть всё"
- **Текущее состояние:** Работает локально (toggleCollapseAll)
- **Примечание:** Уже работает корректно, возможно нужно сохранять состояние в localStorage или user preferences

---

## 2. Загрузка данных (kanban-store.ts)

### loadBoard()
- **Текущее состояние:** Загружает данные из transformMockDataToKanbanBoard()
- **Что нужно:**
  - Загрузка данных из Supabase (разделы, этапы, задачи)
  - Использование view_sections_with_loadings или аналогичных представлений
  - Применение фильтров при загрузке
  - Обработка ошибок и loading состояний

### moveStage()
- **Текущее состояние:** Обновляет только локальное состояние (меняет status этапа)
- **Что нужно:**
  - Отправка изменений на сервер (обновление status этапа в БД)
  - Оптимистичное обновление UI
  - Откат изменений при ошибке
  - Realtime обновления для других пользователей

### updateTaskProgress()
- **Текущее состояние:** Обновляет только локальное состояние
- **Что нужно:**
  - Отправка изменений прогресса задачи на сервер
  - Пересчет прогресса этапа на сервере
  - Обновление связанных данных

### updateTaskPlannedHours()
- **Текущее состояние:** Обновляет только локальное состояние
- **Что нужно:**
  - Отправка изменений плановых часов на сервер
  - Пересчет общих плановых часов этапа и раздела
  - Обновление связанных данных

---

## 3. Модалки и взаимодействия

### Клик по названию раздела (KanbanSwimlane.tsx)
- **Текущее состояние:** console.log('Open section modal for:', section.id)
- **Что нужно:**
  - Открытие модалки с детальной информацией о разделе
  - Возможность редактирования раздела
  - Интеграция с существующей модалкой раздела из модуля planning

### Модалка добавления отчета (AddReportModal.tsx)
- **Текущее состояние:** Возможно, уже работает с моковыми данными
- **Что нужно (проверить):**
  - Сохранение отчета в БД
  - Обновление actualHours задачи
  - Обновление прогресса задачи на основе отчета
  - Уведомления пользователя

### Модалка детального просмотра этапа (StageDetailModal.tsx)
- **Текущее состояние:** Возможно, работает локально
- **Что нужно (проверить):**
  - Загрузка полных данных этапа с сервера
  - Редактирование данных этапа
  - Сохранение изменений на сервере

---

## 4. Drag & Drop

### Перемещение карточек этапов между статусами
- **Текущее состояние:** Работает локально, изменения только в UI
- **Что нужно:**
  - Сохранение нового статуса этапа в БД
  - Проверка прав доступа (может ли пользователь менять статус)
  - Логирование изменений статуса (история)
  - Уведомления заинтересованных лиц

---

## 5. Дополнительные функции для реализации

### Realtime обновления
- **Что нужно:**
  - Подписка на изменения в таблицах этапов и задач через Supabase Realtime
  - Автоматическое обновление UI при изменениях другими пользователями
  - Показ уведомлений о конфликтах (если несколько пользователей редактируют одновременно)

### Права доступа
- **Что нужно:**
  - Проверка прав на редактирование этапов/задач
  - Ограничение видимости разделов по правам пользователя
  - Интеграция с модулем permissions

### Фильтры и сортировка
- **Дополнительные фильтры:**
  - По исполнителю (категории специалистов)
  - По статусу этапа
  - По диапазону дат
  - По проценту выполнения
- **Сортировка:**
  - По дате начала/окончания
  - По прогрессу
  - По плановым часам

### Экспорт данных
- **Что нужно:**
  - Экспорт доски в Excel/PDF
  - Экспорт отчета по этапам и задачам

---

## 6. Интеграция с другими модулями

### Модуль Planning
- Синхронизация данных между Канбан доской и модулем планирования
- Общие данные: разделы, этапы, загрузки

### Модуль Notifications
- Уведомления об изменении статуса этапа
- Уведомления о приближении дедлайна
- Уведомления о назначении задачи

---

## Приоритизация

### Высокий приоритет
1. Загрузка данных из БД (loadBoard)
2. Сохранение изменений статуса этапа (moveStage)
3. Сохранение прогресса и плановых часов задачи
4. Фильтры по организации и проекту

### Средний приоритет
5. Модалка раздела при клике на название
6. Realtime обновления
7. Проверка прав доступа
8. Модалка добавления отчета

### Низкий приоритет
9. Дополнительные фильтры и сортировка
10. Экспорт данных
11. Интеграция с модулем notifications

---

## Примечания

- Все изменения должны логироваться для истории (audit log)
- Необходимо использовать существующие view из БД (view_sections_with_loadings, view_section_hierarchy)
- Сохранять consistency между модулями (Planning и Kanban должны показывать одинаковые данные)
- Использовать TanStack Query для кеширования данных и автоматической инвалидации
