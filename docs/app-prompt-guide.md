# Руководство по приложению для нейросети

## Технологии приложения

- **Frontend Framework**: Next.js 15.2.4 с React 19
- **Стилизация**: Tailwind CSS с утилитами clsx и tailwind-merge
- **UI компоненты**: Радикс UI (Radix UI) - полный набор компонентов с доступностью
- **Темизация**: next-themes для поддержки темной/светлой темы
- **Управление состоянием**: Zustand 5.0.3 с middleware devtools и persist
- **Формы**: react-hook-form с валидацией zod
- **База данных**: Supabase с аутентификацией и SSR интеграцией (@supabase/ssr)
- **Иконки**: Lucide React
- **Уведомления**: Sonner для тостов

## Структура приложения

1. **`app/`** - основные страницы Next.js App Router
   - `auth/` - страницы аутентификации (логин, регистрация, сброс пароля)
   - `dashboard/` - защищенные страницы приложения (основной функционал)

2. **`components/`** - переиспользуемые React компоненты
   - Включает компоненты UI на основе Radix

3. **`hooks/`** - пользовательские React хуки

4. **`lib/`** - служебные функции
   - `utils.ts` - утилиты для работы с классами

5. **`modules/`** - функциональные модули приложения

6. **`public/`** - статические файлы

7. **`stores/`** - хранилища состояния Zustand

8. **`styles/`** - глобальные стили

9. **`utils/`** - утилиты
   - `supabase/` - клиенты и утилиты для Supabase

## Интерфейс взаимодействия с базой данных (Supabase)

Приложение использует Supabase для хранения данных и аутентификации. Взаимодействие происходит через следующие клиенты:

- **Серверный клиент**: `utils/supabase/server.ts` - создает клиент на стороне сервера для серверных компонентов
- **Клиентский клиент**: `utils/supabase/client.ts` - создает клиент на стороне клиента для клиентских компонентов
- **Middleware**: `utils/supabase/middleware.ts` - обрабатывает сессии и перенаправления

Для доступа к базе данных необходимо использовать соответствующий клиент:

```typescript
// В серверном компоненте
import { createClient } from "@/utils/supabase/server"
const supabase = createClient()

// В клиентском компоненте
import { createClient } from "@/utils/supabase/client"
const supabase = createClient()
```

## Работа с Zustand в приложении

Zustand используется для управления глобальным состоянием. Основные хранилища:

1. **`useUserStore`** - хранение информации о пользователе и его профиле
2. **`useSettingsStore`** - хранение пользовательских настроек (например, тема)
3. **`useUiStore`** - хранение состояния UI (открытие/закрытие модалок и т.д.)

Все хранилища используют middleware:
- **devtools** - для отладки в Redux DevTools
- **persist** - для сохранения данных в localStorage

## Информация в хранилищах (stores)

### useUserStore
Хранит информацию о текущем пользователе:
- `id`, `email`, `name` - основная информация
- `profile` - расширенная информация профиля
- `isAuthenticated` - статус аутентификации
- `role` - роль пользователя
- `permissions` - разрешения пользователя

Методы:
- `setUser(userData)` - установка данных пользователя
- `clearUser()` - очистка данных пользователя
- `setRoleAndPermissions(role, permissions)` - установка роли и разрешений

### useSettingsStore
Хранит пользовательские настройки:
- `theme` - текущая тема ('light', 'dark', 'system')

Методы:
- `setTheme(theme)` - изменение темы

## Основные страницы

1. **Аутентификация** (`/auth/*`):
   - Вход (`/auth/login`)
   - Регистрация (`/auth/register`)
   - Восстановление пароля (`/auth/forgot-password`, `/auth/reset-password`)

2. **Дашборд** (`/dashboard/*`):
   - Главная страница дашборда (`/dashboard`)
   - Пользователи (`/dashboard/users`)
   - Задачи (`/dashboard/tasks`)
   - Прогресс (`/dashboard/progress`)
   - Планирование (`/dashboard/planning`)
   - Настройки (`/dashboard/settings`)

## Работа с темой

Тема управляется через `useSettingsStore` и `next-themes`. Для изменения темы:

```typescript
import { useSettingsStore } from "@/stores/useSettingsStore"

// Получить текущую тему
const { theme } = useSettingsStore()

// Изменить тему
const { setTheme } = useSettingsStore()
setTheme('dark') // или 'light', 'system'
```

## Получение состояния аутентификации

Состояние аутентификации доступно через `useUserStore`:

```typescript
import { useUserStore } from "@/stores/useUserStore"

// Проверка аутентификации
const { isAuthenticated, id, email, name, profile } = useUserStore()

// Текущая роль и разрешения
const { role, permissions } = useUserStore()
```

На серверной стороне используйте middleware для проверки сессии и перенаправления неаутентифицированных пользователей.

## Информация для разработки новых модулей

При разработке любого нового функционального модуля (например, "Задачи", "Проекты", "Отчеты" и т.д.), учитывайте следующие моменты:

### 1. Модель данных модуля (TypeScript Interface)

Перед началом разработки определите и согласуйте основной TypeScript интерфейс для сущности вашего модуля.

*Пример для модуля "Задачи":*
```typescript
interface Task {
  id: string; // UUID, Primary Key
  title: string; // Название задачи, обязательное
  description?: string | null; // Описание задачи, необязательное
  status: 'todo' | 'in_progress' | 'done' | 'canceled'; // Статус задачи, обязательное
  priority: 'low' | 'medium' | 'high'; // Приоритет, обязательное
  dueDate?: string | null; // Дата выполнения (ISO 8601), необязательное
  assigneeId?: string | null; // UUID пользователя-исполнителя (ссылка на users.id), необязательное
  projectId?: string | null; // UUID проекта (ссылка на projects.id), необязательное
  createdAt: string; // Дата создания (ISO 8601), управляется БД
  updatedAt: string; // Дата обновления (ISO 8601), управляется БД
  creatorId: string; // UUID пользователя-создателя (ссылка на users.id), обязательное
}
```
**Убедитесь, что интерфейс предоставлен или уточнен для конкретного разрабатываемого модуля.**

### 2. Схема базы данных Supabase

Структура таблиц базы данных, включая колонки, типы данных, ограничения, связи и политики Row Level Security (RLS), описана в отдельном файле: [`docs/database-schema.md`](docs/database-schema.md).

**Перед началом работы с базой данных обязательно изучите этот файл**, чтобы понять существующую структуру и определить, как ваш новый модуль будет интегрироваться (нужны ли новые таблицы, связи, политики RLS).

### 3. Роли и Разрешения (Permissions)

В приложении используется система ролей и разрешений для контроля доступа к данным и функционалу. Основные роли (хранятся в `useUserStore().role` и связаны с таблицами `roles`, `permissions`, `role_permissions` в БД):

- `admin`: Полный доступ.
- `manager`: Расширенный доступ в рамках своих проектов/команд.
- `user`: Базовый доступ.

**Правила доступа для нового модуля:**

- Четко определите, какие действия (Создание, Чтение, Обновление, Удаление - CRUD) доступны для каждой роли (`admin`, `manager`, `user`) в контексте данных вашего модуля.
- Укажите, какие поля могут быть изменены каждой ролью.
- Предполагается, что реализация правил доступа будет осуществляться через **политики RLS в Supabase**. Убедитесь, что необходимые политики описаны или будут созданы (см. `docs/database-schema.md` или уточните отдельно).

*Пример правил доступа для модуля "Задачи":*
- *Создание:* `user`, `manager`, `admin`.
- *Чтение:* `admin` (все), `manager` (в своих проектах), `user` (свои или назначенные).
- *Обновление:* `admin` (все), `manager` (в своих проектах), `user` (только назначенные, ограниченные поля).
- *Удаление:* `admin` (все), `manager` (в своих проектах), `user` (нет доступа).

**Уточните правила доступа для конкретного разрабатываемого модуля.**

### 4. Специфичные UI/UX паттерны

Для обеспечения визуальной и функциональной консистентности приложения, придерживайтесь следующих паттернов и используйте существующие компоненты:

- **Списки/Таблицы:** Используйте `components/ui/table`.
- **Формы:** Используйте `react-hook-form`, `zod`, `components/ui/form`, `input`, `select`, `textarea`, etc.
- **Индикаторы (Статусы, Типы, Приоритеты):** Используйте `components/ui/badge` с согласованными цветами.
- **Модальные окна/Боковые панели:** Используйте `components/ui/dialog` или `components/ui/sheet`.
- **Уведомления/Обратная связь:** Используйте `components/ui/toaster` (`sonner`).

Если для вашего модуля требуются уникальные UI-элементы, обсудите их дизайн и необходимость создания новых компонентов.

## Список ключевых файлов для разработки новых модулей

При разработке нового функционала рекомендуется предоставить нейросети следующие ключевые файлы:

### Конфигурация приложения
- `package.json` - зависимости и скрипты
- `tailwind.config.ts` - настройки Tailwind CSS
- `tsconfig.json` - конфигурация TypeScript
- `next.config.mjs` - конфигурация Next.js

### Хранилища состояния
- `stores/index.ts` - экспорты хранилищ
- `stores/useUserStore.ts` - хранилище данных пользователя
- `stores/useSettingsStore.ts` - хранилище настроек
- `stores/useUiStore.ts` - хранилище состояния UI

### Стили и темы
- `styles/globals.css` - глобальные стили и переменные темы
- `components/theme-provider.tsx` - провайдер темы
- `components/theme-toggle.tsx` - переключатель темы

### Компоненты UI
- `components/ui/button.tsx` - кнопки
- `components/ui/form.tsx` - формы
- `components/ui/input.tsx` - поля ввода
- `components/ui/select.tsx` - селекты
- `components/ui/dialog.tsx` - диалоговые окна
- `components/ui/toast.tsx` и `components/ui/toaster.tsx` - уведомления

### Аутентификация
- `utils/supabase/client.ts` - клиент Supabase для браузера
- `utils/supabase/server.ts` - клиент Supabase для сервера
- `utils/supabase/middleware.ts` - middleware для сессий
- `app/auth/login/page.tsx` - пример страницы входа

### Разметка страниц
- `app/layout.tsx` - основной лейаут
- `app/dashboard/layout.tsx` - лейаут дашборда

### Утилиты
- `lib/utils.ts` - утилиты для работы с классами

### Примеры модулей
- Структура существующего модуля, похожего на разрабатываемый

Предоставление этих файлов даст нейросети полное представление о стиле кода, архитектуре и возможностях приложения, что существенно повысит качество генерируемого кода для нового функционала.

## Руководство по безопасным модификациям

1. При добавлении нового функционала следуйте структуре проекта:
   - UI компоненты размещайте в `components/`
   - Новые страницы в `app/` соответствующего раздела
   - Бизнес-логику в `modules/`

2. При работе с состоянием:
   - Используйте существующие хранилища или создавайте новые в `stores/`
   - Следуйте паттерну с middleware devtools и persist

3. При работе с базой данных:
   - Используйте соответствующие клиенты Supabase
   - Обеспечивайте типизацию запросов и ответов

4. Соблюдайте принципы доступности UI, используя компоненты Radix UI и ARIA атрибуты.

5. Используйте единый стиль кода, соответствующий существующему, и поддерживайте четкую типизацию TypeScript. 