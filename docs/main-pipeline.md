# Пайплайн разработки с нейросетями

Руководство для разработчика и AI-ассистента по совместной разработке функционала.

---

## Фаза 0: Подготовка

### Для разработчика:
1. Создать ветку под фичу: `git checkout -b feature/название-фичи`
2. Сформулировать глобальную задачу в 2-3 предложениях
3. Определить критерии готовности (Definition of Done)

### Для нейросети:
1. Изучить контекст проекта:
   - `CLAUDE.md` — основные правила и паттерны
   - `modules/cache/README.md` — система кеширования
   - `types/db.ts` — типы базы данных
   - Примеры существующих модулей (структура, hooks, actions)
2. Понять текущую архитектуру и не предлагать решения, противоречащие ей

---

## Фаза 1: Декомпозиция задачи

### Разработчик:
- Описывает глобальную цель и бизнес-требования
- Указывает ограничения и приоритеты

### Нейросеть:
- Разбивает задачу на этапы с чёткими границами
- Определяет зависимости между этапами
- Создаёт документ-план в `docs/features/название-фичи.md`

**Формат документа-плана:**
```markdown
# Название фичи

## Цель
[Краткое описание]

## Этапы реализации

### Этап 1: [Название]
- Описание
- Затрагиваемые файлы
- Зависимости

### Этап 2: [Название]
...

## Критерии готовности
- [ ] Критерий 1
- [ ] Критерий 2
```

---

## Фаза 2: Цикл разработки этапа

Повторяется для каждого этапа из плана.

### Шаг 2.1: Планирование этапа

**Разработчик:**
- Уточняет требования к этапу
- Задаёт вопросы по неясным моментам

**Нейросеть:**
- Составляет детальный план реализации:
  - Архитектура решения
  - Используемые технологии и паттерны проекта
  - Новые файлы и изменения в существующих
  - Потенциальные проблемы и edge-cases
  - Интеграция с существующим кодом

### Шаг 2.2: Ревью плана

**Разработчик:**
- Проверяет соответствие паттернам проекта
- Оценивает сложность и риски
- Вносит корректировки
- Даёт "добро" на реализацию

**Критерии хорошего плана:**
- Нет over-engineering
- Использует существующие абстракции (cache module, hooks)
- Минимальные изменения для достижения цели
- Учитывает типобезопасность

### Шаг 2.3: Реализация

**Нейросеть:**
- Пошаговая имплементация согласно плану
- После изменений схемы БД → `npm run db:types`
- Проверка сборки → `npm run build`

**Разработчик:**
- Следит за процессом
- Останавливает при отклонении от плана

### Шаг 2.4: Ручное тестирование

**Нейросеть составляет чек-лист:**
```markdown
## Чек-лист тестирования этапа N

### Позитивные сценарии
- [ ] Сценарий 1: [описание] → ожидаемый результат
- [ ] Сценарий 2: [описание] → ожидаемый результат

### Негативные сценарии
- [ ] Невалидные данные → корректная ошибка
- [ ] Отсутствие прав → редирект/сообщение

### Edge-cases
- [ ] Пустые данные
- [ ] Большие объёмы данных
- [ ] Параллельные операции
```

**Разработчик:**
- Проходит чек-лист вручную
- Фиксирует найденные баги
- Сообщает результаты нейросети

### Шаг 2.5: Code Review

**Нейросеть проводит ревью по критериям:**

1. **Архитектура**
   - Соответствие паттернам проекта
   - Правильное разделение ответственности
   - Корректное использование module boundaries

2. **Дублирование кода**
   - Нет копипасты запросов к БД
   - Переиспользование cache hooks
   - Общие компоненты вынесены

3. **Безопасность**
   - Проверка прав доступа (permissions)
   - Защита от SQL injection (параметризованные запросы)
   - Валидация входных данных (Zod)
   - Нет утечки чувствительных данных

4. **Обработка ошибок**
   - Try-catch в нужных местах
   - Понятные сообщения пользователю
   - Логирование в Sentry

5. **TypeScript**
   - Нет `any` без необходимости
   - Корректные типы из `types/db.ts`
   - Строгая типизация props и returns

6. **Производительность**
   - Нет N+1 запросов
   - Использование views вместо множественных joins
   - Оптимистичные обновления где уместно

### Шаг 2.6: Исправления

**Нейросеть:**
- Исправляет замечания из ревью
- Объясняет каждое изменение

**Разработчик:**
- Подтверждает исправления

### Шаг 2.7: Коммит

**Формат коммита:**
```
feat(module-name): краткое описание

- Детали изменения 1
- Детали изменения 2

Этап N из M для #issue-number
```

**Один этап = один коммит** (или несколько логически связанных)

### Шаг 2.8: Переход к следующему этапу

→ Возврат к шагу 2.1 для следующего этапа

---

## Фаза 3: Завершение фичи

### Интеграционное тестирование
- Проверить взаимодействие всех этапов
- Тестирование полного user flow
- Проверка на разных ролях пользователей

### Финальный ревью
**Нейросеть проверяет:**
- Консистентность кода между этапами
- Отсутствие "мёртвого" кода
- Актуальность документации модуля
- README модуля обновлён (если нужно)

### Подготовка PR
**Нейросеть помогает составить:**
```markdown
## Summary
- [Краткое описание фичи]
- [Ключевые изменения]

## Changes
- Добавлен модуль X
- Изменена логика Y
- Обновлены типы Z

## Testing
- [ ] Ручное тестирование пройдено
- [ ] Сборка успешна (`npm run build`)
- [ ] Линтер пройден (`npm run lint`)

## Screenshots (если UI)
[скриншоты]
```

### Merge
- Создать PR в main
- После апрува — merge
- Удалить feature-ветку

---

## Чек-лист для нейросети

Перед каждым действием проверять:

- [ ] Прочитан ли необходимый контекст?
- [ ] Соответствует ли решение паттернам проекта?
- [ ] Используются ли существующие абстракции?
- [ ] Нет ли over-engineering?
- [ ] Обновлены ли типы после изменения схемы?
- [ ] Проходит ли сборка?

---

## Чек-лист для разработчика

Перед каждым этапом:

- [ ] Понятна ли цель этапа?
- [ ] Согласован ли план реализации?
- [ ] Есть ли чёткие критерии готовности?

После каждого этапа:

- [ ] Пройдено ли ручное тестирование?
- [ ] Исправлены ли замечания ревью?
- [ ] Сделан ли коммит?

---

## Антипаттерны (чего избегать)

1. **Пропуск планирования** — сразу кодить без плана
2. **Игнорирование ревью** — не исправлять замечания
3. **Большие этапы** — этап должен быть обозримым (1-4 часа работы)
4. **Отсутствие тестирования** — "потом проверю"
5. **Коммиты без смысла** — "fix", "update", "changes"
6. **Отклонение от паттернов** — изобретать своё вместо использования существующего
7. **Накопление долга** — откладывать исправления на потом
