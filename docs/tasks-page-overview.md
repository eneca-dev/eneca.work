# Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° /tasks â€” ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
/tasks page
â”œâ”€â”€ TasksView (Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚)
â”‚   â”œâ”€â”€ Header (sticky)
â”‚   â”‚   â”œâ”€â”€ Tabs: ĞšĞ°Ğ½Ğ±Ğ°Ğ½ | Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº | ĞÑ‚Ğ´ĞµĞ»Ñ‹ | Ğ‘ÑĞ´Ğ¶ĞµÑ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ Locked filters badges (Ğ¸Ğ· permissions)
â”‚   â”‚   â””â”€â”€ InlineFilter
â”‚   â””â”€â”€ Content (Ğ¿Ğ¾ viewMode)
â”‚       â”œâ”€â”€ KanbanBoardInternal
â”‚       â”œâ”€â”€ ResourceGraphInternal
â”‚       â”œâ”€â”€ DepartmentsTimelineInternal
â”‚       â””â”€â”€ BudgetsViewInternal
â””â”€â”€ PermissionsDebugPanel (dev only)
```

---

## ĞœĞ¾Ğ´ÑƒĞ»Ğ¸

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ exports |
|--------|-----------|------------------|
| `modules/tasks` | ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ | TasksView, stores |
| `modules/inline-filter` | ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² | parseFilterString, tokensToQueryParams |
| `modules/permissions` | Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ | useFilterContext, useFilteredOptions, getLockedFilters |
| `modules/cache` | ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | queryKeys, createSimpleCacheQuery |
| `modules/resource-graph` | Timeline (Gantt) | ResourceGraphInternal, useResourceGraphData |
| `modules/budgets-page` | Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ Ñ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ°Ğ¼Ğ¸ | BudgetsViewInternal, useBudgetsHierarchy |
| `modules/budgets` | Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ¾Ğ² | useBudgets, BudgetCurrent |
| `modules/kanban` | ĞšĞ°Ğ½Ğ±Ğ°Ğ½-Ğ´Ğ¾ÑĞºĞ° | KanbanBoardInternal |
| `modules/departments-timeline` | Timeline Ğ¾Ñ‚Ğ´ĞµĞ»Ğ¾Ğ² | DepartmentsTimelineInternal |
| `modules/modals` | ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ĞºĞ½Ğ° | BudgetCreateModal, SectionModal, LoadingModal |

---

## Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Cache Module)

### Query Keys Ğ¿Ğ¾ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ°Ğ¼

| Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ° | Query Keys |
|---------|------------|
| **ĞĞ±Ñ‰Ğ¸Ğµ** | `filterStructure.org()`, `filterStructure.project()`, `filterStructure.tags()`, `filterPermissions.context()` |
| **ĞšĞ°Ğ½Ğ±Ğ°Ğ½** | `kanban.infinite(filters)`, `kanban.list(filters)`, `stageStatuses.list()` |
| **Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº** | `resourceGraph.list(filters)`, `resourceGraph.sectionsBatch(objectId)`, `resourceGraph.workLogs(sectionId)`, `resourceGraph.loadings(sectionId)` |
| **Ğ‘ÑĞ´Ğ¶ĞµÑ‚Ñ‹** | `budgets.list()`, `budgets.bySection(sectionId)` |

### Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² ĞºĞ¾Ğ´Ğµ

```typescript
// modules/tasks/hooks/useTasksFilterOptions.ts
createSimpleCacheQuery({
  queryKey: queryKeys.filterStructure.org(),
  queryFn: getOrgStructure,
  staleTime: staleTimePresets.static,
})
```

---

## Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ (Permissions)

### Hooks

| Hook | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|-----------|
| `useFilterContext()` | Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ |
| `useFilteredOptions()` | Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ Ğ¾Ğ¿Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ scope Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ |
| `getLockedFilters()` | ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ UI |

### Filter Scope

```typescript
filterScope: {
  level: 'all' | 'subdivision' | 'department' | 'team' | 'projects'
  subdivisionIds: string[]
  departmentIds: string[]
  teamIds: string[]
  projectIds: string[]
  isLocked: boolean
}
```

### ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ

- **Locked filters** â€” Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ÑÑ ĞºĞ°Ğº badges Ğ² header (Ğ½ĞµĞ»ÑŒĞ·Ñ ÑĞ½ÑÑ‚ÑŒ)
- **Filtered options** â€” Ğ² Ğ²Ñ‹Ğ¿Ğ°Ğ´Ğ°ÑÑ‰Ğ¸Ñ… ÑĞ¿Ğ¸ÑĞºĞ°Ñ… Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¾Ğ¿Ñ†Ğ¸Ğ¸
- **Query params** â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹

---

## Dataflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    useFilterContext()                        â”‚
â”‚              (permissions/filter scope)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              useTasksFilterOptions()                         â”‚
â”‚    getOrgStructure + getProjectStructure + getProjectTags   â”‚
â”‚              + useFilteredOptions()                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   InlineFilter                               â”‚
â”‚         filterString â†’ parseFilterString() â†’ tokens         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              tokensToQueryParams()                           â”‚
â”‚              + lockedFilters merge                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ResourceGraph / BudgetsView / Kanban / DepartmentsTimeline â”‚
â”‚                 (queryParams prop)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Server Actions

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | Action | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|--------|--------|-----------|
| `resource-graph` | `getOrgStructure()` | Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ |
| `resource-graph` | `getProjectStructure()` | Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² |
| `resource-graph` | `getProjectTags()` | ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸ |
| `resource-graph` | `getResourceGraphData()` | Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ timeline |
| `resource-graph` | `getStageReadinessSnapshots()` | Ğ§ĞµĞºĞ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ |
| `budgets` | `getBudgets()` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ¾Ğ² |
| `budgets` | `createBudget()` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ° |
| `budgets` | `updateBudget()` | ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ° |

---

## Stores (Zustand)

| Store | ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | Persisted | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|-------|--------|-----------|-----------|
| `useTasksFiltersStore` | tasks | Ğ”Ğ° | filterString |
| `useTasksViewStore` | tasks | Ğ”Ğ° | viewMode (kanban/timeline/budgets/departments) |
| `useDisplaySettingsStore` | resource-graph | Ğ”Ğ° | ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ |
| `useUIStateStore` | resource-graph | ĞĞµÑ‚ | Expand/collapse |
| `useFiltersStore` | resource-graph | ĞĞµÑ‚ | Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ |
| `useModalStore` | modals | ĞĞµÑ‚ | Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´Ğ°Ğ»Ğ¾Ğº |

---

## Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ (legacy)
```
Project
â””â”€â”€ Stage              â† Ğ£Ğ”ĞĞ›Ğ˜Ğ¢Ğ¬ (ÑÑ‚Ğ°Ğ´Ğ¸Ñ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
    â””â”€â”€ Object
        â””â”€â”€ Section
            â””â”€â”€ DecompositionStage
                â””â”€â”€ DecompositionItem
```

### Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ (Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°)
```
Project (stage_name ĞºĞ°Ğº Ğ¿Ğ¾Ğ»Ğµ)
â””â”€â”€ Object
    â””â”€â”€ Section (Ñ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ°Ğ¼Ğ¸)
        â””â”€â”€ DecompositionStage (Ñ loadings)
            â””â”€â”€ DecompositionItem
```

---

## Inline Filter

### Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ

```
Ğ¿Ğ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ:"ĞĞ’" Ğ¿Ñ€Ğ¾ĞµĞºÑ‚:"ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" Ğ¼ĞµÑ‚ĞºĞ°:"Ğ²Ğ°Ğ¶Ğ½Ğ¾Ğµ"
```

### TASKS_FILTER_CONFIG

| ĞšĞ»ÑÑ‡ | Field | Multiple |
|------|-------|----------|
| `Ğ¿Ğ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ` | subdivision_id | ĞĞµÑ‚ |
| `Ğ¾Ñ‚Ğ´ĞµĞ»` | department_id | ĞĞµÑ‚ |
| `ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°` | team_id | ĞĞµÑ‚ |
| `Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹` | responsible_id | ĞĞµÑ‚ |
| `Ğ¿Ñ€Ğ¾ĞµĞºÑ‚` | project_id | ĞĞµÑ‚ |
| `Ğ¼ĞµÑ‚ĞºĞ°` | tag_id | Ğ”Ğ° |

---

## Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ¸ â€” Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

| Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ° | ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Cache | Permissions | ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ |
|---------|-----------|-------|-------------|-------------|
| **ĞšĞ°Ğ½Ğ±Ğ°Ğ½** | KanbanBoardInternal | kanban.* | useFilterContext | Infinite scroll |
| **Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº** | ResourceGraphInternal | resourceGraph.* | useFilterContext | Gantt timeline |
| **ĞÑ‚Ğ´ĞµĞ»Ñ‹** | DepartmentsTimelineInternal | departments.* | â€” | Timeline Ğ¿Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»Ğ°Ğ¼ |
| **Ğ‘ÑĞ´Ğ¶ĞµÑ‚Ñ‹** | BudgetsViewInternal | budgets.* | â€” | Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ + inline edit |

---

## ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### ResourceGraph

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|-----------|-----------|
| `TimelineHeader` | Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ Ğ´Ğ°Ñ‚Ğ°Ğ¼Ğ¸ |
| `TimelineRow` / `TimelineBar` | Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸ Ğ¸ Ğ±Ğ°Ñ€Ñ‹ |
| `SectionRow` | Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° |
| `DecompositionStageRow` | Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑÑ‚Ğ°Ğ¿Ğ° Ğ´ĞµĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ |
| `BudgetsRow` | ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ¾Ğ² |
| `ReadinessGraph` | Ğ“Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ |
| `WorkLogMarkers` | ĞœĞ°Ñ€ĞºĞµÑ€Ñ‹ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‚ |

### BudgetsPage

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|-----------|-----------|
| `BudgetsHierarchy` | Ğ”ĞµÑ€ĞµĞ²Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² |
| `BudgetRow` | Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ° |
| `BudgetCell` | Ğ¯Ñ‡ĞµĞ¹ĞºĞ° Ñ ÑÑƒĞ¼Ğ¼Ğ¾Ğ¹ |
| `BudgetInlineEdit` | Inline-Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ |
| `BudgetCreatePopover` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ° |

### Modals

| ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ° | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|---------|-----------|
| `BudgetCreateModal` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ° |
| `CheckpointEditModal` | Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ checkpoint |
| `SectionModal` | Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° |
| `LoadingModal` | Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ |

---

## Ğ¡Ğ²ÑĞ·Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  modules/cache  â”‚
                    â”‚  (query keys)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ modules/tasks â”‚  â”‚ modules/kanban  â”‚  â”‚ modules/budgets â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                    â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   â”‚               â”‚                    â”‚
        â–¼   â–¼               â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ modules/inline-   â”‚  â”‚ modules/        â”‚  â”‚ modules/        â”‚
â”‚ filter            â”‚  â”‚ resource-graph  â”‚  â”‚ budgets-page    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ modules/modals  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ modules/permissions â”‚
                    â”‚ (filter context)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² tasks, kanban, resource-graph
```

---

## TODO: Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ¿Ğ°

---

## ğŸš« Ğ¡Ğ¢ĞĞŸ-Ğ›Ğ˜Ğ¡Ğ¢: ĞĞ• Ğ¢Ğ ĞĞ“ĞĞ¢Ğ¬!

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ/ĞŸÑƒÑ‚ÑŒ | ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° |
|-------------|---------|
| `modules/planning/` | Production Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ, ÑĞ²Ğ¾Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¾ stage |
| `modules/projects/` | Production Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ, ÑĞ²Ğ¾Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° |
| `app/(dashboard)/planning/` | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ |
| `app/(dashboard)/projects/` | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² |
| Views: `view_project_tree`, `view_project_tree_backup` | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ğ² planning/projects |

**Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ /tasks!**

---

### 1. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ View Ğ² Ğ‘Ğ”

**Ğ¦ĞµĞ»ÑŒ:** `v_resource_graph` â€” objects Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ¿Ğ¾Ğ´ project.

```sql
-- Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ:
project_id â†’ stage_id â†’ object_id â†’ section_id

-- Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ:
project_id â†’ object_id â†’ section_id
-- stage_name Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ ĞºĞ°Ğº Ğ¿Ğ¾Ğ»Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
```

**Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:**
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ view `v_resource_graph` (ÑƒĞ±Ñ€Ğ°Ñ‚ÑŒ stage_id Ğ¸Ğ· Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ğ¸)
- [ ] `npm run db:types`

---

### 2. Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Stage Ğ¸Ğ· UI

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | Ğ¤Ğ°Ğ¹Ğ» | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ |
|--------|------|----------|
| `resource-graph` | `types/index.ts` | Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ `Stage`, `Project.stages` â†’ `Project.objects` |
| `resource-graph` | `utils/index.ts` | `transformRowsToHierarchy` â€” Ğ±ĞµĞ· stage |
| `resource-graph` | `utils/hierarchy.ts` | Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ `'stage'` Ğ¸Ğ· `HierarchyLevel` |
| `resource-graph` | `rows/StageRow.tsx` | Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ |
| `resource-graph` | `rows/ProjectRow.tsx` | ObjectRow Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ |
| `resource-graph` | `rows/index.ts` | Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ StageRow |
| `kanban` | `transform-rows-to-kanban.ts` | Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ stage Ğ¸Ğ· Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ° |
| `budgets-page` | â€” | âœ… Ğ£Ğ¶Ğµ Ğ±ĞµĞ· stage |

**DecompositionStage (ÑÑ‚Ğ°Ğ¿ Ğ´ĞµĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸) â€” ĞĞ¡Ğ¢ĞĞĞ¢Ğ¡Ğ¯!**

---

### 3. Ğ§ĞµĞº-Ğ»Ğ¸ÑÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

- [ ] `npm run db:types`
- [ ] `npm run build`
- [ ] /tasks â€” Ğ²ÑĞµ 4 Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚
- [ ] /planning â€” ĞĞ• ÑĞ»Ğ¾Ğ¼Ğ°Ğ»ÑÑ
- [ ] /projects â€” ĞĞ• ÑĞ»Ğ¾Ğ¼Ğ°Ğ»ÑÑ
