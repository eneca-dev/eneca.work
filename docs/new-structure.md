# Структура проекта eneca.work (Гибридный подход)

Этот документ описывает гибридную структуру папок проекта, сочетающую принципы Feature-Sliced Design с удобным управлением общими ресурсами.

## Основные папки и их назначение

```
/
├── app/                 # Next.js: роутинг, layout'ы страниц, точка входа
│   ├── layout.tsx
│   ├── page.tsx
│   ├── global.css
│   ├── api/
│   │   └── auth/
│   │       └── [...nextauth]/route.ts
│   └── dashboard/
│       ├── layout.tsx
│       └── settings/
│           └── page.tsx
│
├── modules/             # Функциональные модули приложения (фичи)
│   ├── users/
│   │   ├── components/
│   │   │   ├── UserProfileCard.tsx
│   │   │   └── UserList.tsx
│   │   ├── lib/
│   │   │   ├── types.ts
│   │   │   ├── data-service.ts
│   │   │   └── hooks.ts
│   │   └── index.ts     # (Опционально) Публичный API модуля
│   └── projects/
│       ├── components/
│       │   └── CreateProjectModal.tsx
│       ├── lib/
│       │   └── types.ts
│       └── index.ts
│
├── shared/              # Общие ресурсы, используемые МЕЖДУ модулями
│   ├── ui/              # Переиспользуемые UI-компоненты (UI-кит)
│   │   ├── Button.tsx
│   │   ├── Input.tsx
│   │   └── Modal.tsx
│   ├── lib/             # Общие утилиты и хелперы
│   │   └── utils/
│   │       ├── formatters.ts
│   │       └── validators.ts
│   ├── hooks/           # Общие кастомные React-хуки
│   │   └── useDebounce.ts
│   ├── assets/          # Общие статические ресурсы
│   │   ├── icons/
│   │   └── images/
│   └── config/          # Глобальные константы и настройки
│       ├── constants.ts
│       └── routes.ts
│
├── store/               # Глобальное состояние (Redux Toolkit)
│   ├── slices/
│   │   ├── userSlice.ts
│   │   ├── projectSlice.ts
│   │   └── uiSlice.ts
│   ├── store.ts
│   └── hooks.ts
│
├── core/                # Ядро приложения, интеграции
│   ├── supabase/
│   │   ├── client.ts
│   │   └── database.types.ts
│   └── api/             # (Если нужно) Обертки API, middleware
│       └── axios-client.ts
│
├── styles/              # Глобальные стили, темы, переменные
│   ├── globals.css
│   └── tailwind.config.js
│
├── public/              # Статические файлы (отдаются "как есть")
│   ├── favicon.ico
│   └── robots.txt
│
└── docs/                # Документация проекта
    ├── README.md
    └── new-structure.md
```

---

### 1. `app/`
*   **Назначение:** Основа Next.js App Router. Определяет структуру URL приложения, обрабатывает рендеринг страниц и layout'ов. Содержит точки входа для серверных и клиентских компонентов.
*   **Примеры содержимого:**
    *   `layout.tsx`: Корневой layout приложения (включает `<html>`, `<body>`, может подключать глобальные контексты, `header`, `footer`).
    *   `page.tsx`: Главная страница приложения (маршрут `/`).
    *   `global.css`: Глобальные стили, импортируемые в `layout.tsx`.
    *   `loading.tsx`: Стандартный компонент загрузки Next.js.
    *   `error.tsx`: Стандартный компонент обработки ошибок Next.js.
    *   `not-found.tsx`: Стандартный компонент страницы 404.
    *   `[...slug]/page.tsx`: Динамический маршрут.
    *   `dashboard/layout.tsx`: Layout для секции `/dashboard`.
    *   `dashboard/settings/page.tsx`: Страница настроек в секции dashboard (`/dashboard/settings`).
    *   `api/auth/[...nextauth]/route.ts`: Обработчик API маршрутов для NextAuth.js.
*   **Взаимодействие:** Импортирует компоненты и логику из `modules/`, `shared/`, `store/`, `core/` для отображения страниц и управления состоянием на уровне маршрутов.

---

### 2. `modules/`
*   **Назначение:** Изолированные функциональные блоки приложения (фичи). Каждый модуль содержит все необходимое для своей работы (UI, логику, типы).
*   **Примеры содержимого:**
    *   `modules/`
        *   `users/`
            *   `components/`
                *   `UserProfileCard.tsx`: Карточка профиля пользователя (используется только внутри модуля users).
                *   `UserList.tsx`: Список пользователей.
                *   `EditUserForm.tsx`: Форма редактирования.
            *   `lib/`
                *   `types.ts`: Интерфейсы и типы для пользователя (`User`, `UserRole`).
                *   `data-service.ts`: Функции для получения/обновления данных пользователя с бэкенда (`fetchUserById`, `updateUserSettings`).
                *   `hooks.ts`: Специфичные хуки для модуля (`useUserPermissions`).
                *   `constants.ts`: Константы, релевантные только для модуля users.
            *   `index.ts`: (Опционально) Экспортирует главный компонент или типы, если они нужны в `app/`.
        *   `projects/`
            *   `components/`
                *   `ProjectGrid.tsx`: Сетка проектов.
                *   `CreateProjectModal.tsx`: Модальное окно создания проекта.
            *   `lib/`
                *   `types.ts`: Типы для проекта (`Project`, `ProjectStatus`).
                *   `data-service.ts`: Функции API для проектов.
            *   `index.ts`
*   **Взаимодействие:** Импортирует компоненты и утилиты из `shared/`. Может диспатчить экшены и использовать селекторы из `store/`. Использует клиент Supabase или другие API-функции из `core/`. Публичные части модуля (при необходимости) импортируются в `app/` для отображения на страницах. **Не должен** импортировать напрямую из других модулей.

---

### 3. `shared/`
*   **Назначение:** Хранилище общих, переиспользуемых ресурсов, доступных для всего приложения (модулей, страниц, ядра).
*   **Примеры содержимого:**
    *   `ui/`:
        *   `Button.tsx`
        *   `Input.tsx`
        *   `Modal.tsx`
        *   `Spinner.tsx`
        *   `Layout.tsx` (например, `PageLayout`, `SidebarLayout`)
        *   `Icon.tsx` (компонент для отображения SVG иконок)
    *   `lib/`:
        *   `utils/formatters.ts`: Функции форматирования (`formatDate`, `formatCurrency`).
        *   `utils/validators.ts`: Функции валидации (`isValidEmail`, `isStrongPassword`).
        *   `helpers/storage.ts`: Обертки для `localStorage`/`sessionStorage`.
    *   `hooks/`:
        *   `useDebounce.ts`
        *   `useLocalStorage.ts`
        *   `useMediaQuery.ts`
    *   `assets/`:
        *   `icons/`: Коллекция SVG иконок.
        *   `images/`: Общие изображения (логотип, фоны).
    *   `config/`:
        *   `constants.ts`: Глобальные константы (`ITEMS_PER_PAGE`).
        *   `routes.ts`: Константы путей приложения.
*   **Взаимодействие:** Импортируется всеми другими слоями (`app/`, `modules/`, `store/`, `core/`). **Не должен** импортировать из других слоев (особенно из `modules/` или `app/`).

---

### 4. `store/`
*   **Назначение:** Управление глобальным состоянием приложения с помощью Redux Toolkit.
*   **Примеры содержимого:**
    *   `slices/`:
        *   `userSlice.ts`: Состояние и редьюсеры для данных пользователя.
        *   `projectSlice.ts`: Состояние и редьюсеры для проектов.
        *   `uiSlice.ts`: Состояние UI (например, открыта ли боковая панель, тема).
    *   `store.ts`: Создание и конфигурация Redux store, подключение middleware.
    *   `hooks.ts`: Экспорт типизированных хуков `useAppDispatch` и `useAppSelector`.
    *   `selectors/` (опционально): Сложные селекторы для Мемоизации с `reselect`.
*   **Взаимодействие:** Импортируется в `app/` (для Provider'а) и в компоненты (в `modules/` или `shared/`) для доступа к состоянию и диспатча экшенов через хуки. Может импортировать типы из `modules/` или `shared/`.

---

### 5. `core/`
*   **Назначение:** Низкоуровневая логика, интеграция с внешними сервисами (БД, API), инициализация библиотек.
*   **Примеры содержимого:**
    *   `supabase/`:
        *   `client.ts`: Инициализация клиента Supabase (для браузера и/или сервера).
        *   `database.types.ts`: Автоматически сгенерированные типы для таблиц БД Supabase.
        *   `auth-helpers.ts`: Вспомогательные функции для работы с аутентификацией Supabase.
    *   `api/`:
        *   `axios-client.ts`: Настроенный экземпляр Axios (если используется для других API).
        *   `middleware/auth.ts`: Middleware для проверки авторизации на API роутах Next.js.
    *   `services/`: (опционально)
        *   `EmailService.ts`: Класс или функции для отправки email.
*   **Взаимодействие:** Предоставляет инициализированные клиенты и утилиты для работы с внешними системами. Импортируется в `modules/` (для выполнения запросов к данным), `app/` (для API роутов или Server Actions), `store/` (например, в thunks/async actions). **Не должен** импортировать из `modules/`, `app/`, `store/`, `shared/`.

---

### 6. `styles/`
*   **Назначение:** Глобальные стили, темы, конфигурация CSS фреймворков.
*   **Примеры содержимого:**
    *   `globals.css`: Основные глобальные стили (переопределение стандартных тегов, CSS переменные).
    *   `tailwind.config.js`: Конфигурация Tailwind CSS.
    *   `variables.scss`: SCSS переменные (цвета, шрифты, размеры).
    *   `themes/`: (если есть темы)
        *   `dark-theme.css`
        *   `light-theme.css`
*   **Взаимодействие:** `globals.css` импортируется в `app/layout.tsx`. Конфигурации (`tailwind.config.js`) используются инструментами сборки. Переменные могут импортироваться в CSS модули компонентов.

---

### 7. `public/`
*   **Назначение:** Статические ассеты, доступные напрямую по URL.
*   **Примеры содержимого:**
    *   `favicon.ico`
    *   `robots.txt`
    *   `sitemap.xml`
    *   `fonts/`: Файлы шрифтов (если не подключаются иначе).
    *   `images/`: Изображения, которые не требуют обработки Next.js Image (например, лого партнеров).
*   **Взаимодействие:** Файлы доступны веб-сервером напрямую. Ссылки на них используются в `app/` (например, в `<head>`).

---

### 8. `docs/`
*   **Назначение:** Документация по проекту.
*   **Примеры содержимого:**
    *   `README.md`: Основное описание проекта.
    *   `architecture.md`: Описание архитектуры (похоже на `new-structure.md`).
    *   `conventions.md`: Соглашения по кодированию.
    *   `setup.md`: Инструкции по установке и запуску.
    *   `modules/`: Документация по конкретным модулям.
*   **Взаимодействие:** Не участвует в коде приложения, служит для разработчиков.

---

## Интеграция нового модуля

При добавлении новой функциональности (например, "Задачи" - `tasks`):

1.  **Создать папку модуля**: Создайте папку `modules/tasks`.
2.  **Внутренняя структура**: Внутри `modules/tasks` создайте подпапки `components/` и `lib/` по мере необходимости.
    *   Разместите UI-компоненты, относящиеся только к задачам, в `modules/tasks/components/`.
    *   Типы, функции для работы с данными задач, специфичные хуки поместите в `modules/tasks/lib/`.
3.  **Глобальное состояние (если нужно)**: Если для задач требуется глобальное состояние, создайте `tasksSlice.ts` в `store/slices/` и добавьте его в `store/store.ts`.
4.  **Общие ресурсы**: Если в процессе разработки модуля выявляются компоненты, утилиты или хуки, которые могут быть полезны и в других частях приложения, выносите их в соответствующие подпапки `shared/` (`shared/ui/`, `shared/lib/`, `shared/hooks/`).
5.  **Страницы/Роутинг**: Создайте необходимые страницы/маршруты для модуля "Задачи" в папке `app/` (например, `app/tasks/page.tsx`, `app/tasks/[taskId]/page.tsx`). Эти страницы будут импортировать и использовать компоненты из `modules/tasks/` (возможно, через `modules/tasks/index.ts`).
6.  **Публичный API модуля (опционально)**: Если компоненты или функции из `modules/tasks/` должны использоваться другими модулями напрямую (старайтесь этого избегать), экспортируйте их через `modules/tasks/index.ts`.
7.  **Документация**: Обновите документацию в `docs/`, если создание нового модуля повлияло на общую архитектуру или требует пояснений.

---

**Правило импортов**:
*   Код внутри модуля (`modules/tasks/`) может импортировать из `shared/`, `core/`, `store/` и изнутри самого себя.
*   Код внутри модуля **не должен** напрямую импортировать из других модулей (`modules/users/`, `modules/projects/`). Если нужна коммуникация между модулями, она обычно происходит через глобальное состояние (`store/`) или через общие страницы в `app/`.
*   Код в `shared/` **не должен** импортировать из `modules/`, `app/`, `store/`. Он должен быть максимально независимым.
*   Код в `app/` и `store/` может импортировать из `modules/` (желательно через их `index.ts`), `shared/`, `core/`.
*   Код в `core/` **не должен** импортировать из `modules/`, `app/`, `store/`, `shared/`.
